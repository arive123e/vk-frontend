<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–∞–≥–∏—á–µ—Å–∫–∏–π –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫ ‚Äú–§–æ–∫—É—Å–Ω–∏–∫ –ê–ª—å—Ç–∞–∏—Ä‚Äù üßôüèº‚Äç‚ôÇÔ∏è</title>
  <!-- VK ID SDK (–Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å tg_id) -->
  <script src="https://unpkg.com/@vkid/sdk@2.5.2/dist-sdk/umd/index.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', 'Verdana', system-ui, sans-serif;
      background: linear-gradient(135deg, #5e35b1 0%, #26c6da 100%);
      min-height: 100vh;
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
    }
    .container {
      max-width: 440px;
      margin: 40px auto 0 auto;
      background: rgba(30, 22, 61, 0.83);
      border-radius: 1.5em;
      box-shadow: 0 6px 36px #0008;
      padding: 32px 22px 24px 22px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      font-family: 'Montserrat', 'Segoe UI', 'Verdana', system-ui, sans-serif;
      font-size: 2.1em;
      font-weight: bold;
      color: #e6c97c;
      text-align: center;
      margin-bottom: 8px;
      text-shadow: 0 1px 8px #0005, 0 0 1px #fff;
      letter-spacing: 0.5px;
    }
    h2 {
      color: #ffecb3;
      margin: 18px 0 8px 0;
      font-size: 1.13em;
      font-weight: 600;
    }
    .motivation {
      font-size: 1.12em;
      color: #80d8ff;
      font-style: italic;
      margin-bottom: 10px;
      text-align: center;
    }
    .desc {
      margin-bottom: 14px;
      text-align: center;
      font-size: 1.13em;
      color: #fffde7;
    }
    .magic {
      margin: 16px 0 12px 0;
      font-size: 1.15em;
      font-weight: 500;
      color: #e6c97c;
      text-shadow: 0 0 4px #251652;
      letter-spacing: 0.5px;
    }
    .features {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 12px;
      margin-top: 5px;
      width: 100%;
    }
    .feature {
      background: #322265;
      border-radius: 1em;
      padding: 8px 10px;
      flex: 1 1 0;
      font-size: 0.98em;
      text-align: center;
      color: #ffe082;
      box-shadow: 0 0 8px #0002;
      border: 1px solid #432b7d;
    }
    .button {
      display: block;
      margin: 22px auto 0 auto;
      padding: 14px 0;
      background: linear-gradient(90deg, #7c4dff 0%, #1de9b6 100%);
      color: #fff;
      border: none;
      border-radius: 1em;
      font-size: 1.2em;
      font-family: inherit;
      font-weight: bold;
      box-shadow: 0 4px 24px #311b9288;
      cursor: pointer;
      transition: background 0.16s;
      width: 100%;
      letter-spacing: 0.3px;
      text-shadow: 0 1px 6px #0005;
    }
    .button:hover {
      background: linear-gradient(90deg, #8e24aa 0%, #00bfae 100%);
    }
    .vk-container {
      margin-top: 16px;
      width: 100%;
    }
    .error, .success {
      color: #ff5252;
      margin-top: 18px;
      text-align: center;
      font-size: 1em;
    }
    .success {
      color: #76ff03;
    }
    .privacy, .contact {
      margin-top: 20px;
      font-size: 0.99em;
      color: #b0bec5;
      text-align: center;
    }
    .privacy a {
      color: #ffd600;
      text-decoration: underline;
      transition: color .17s;
    }
    .privacy a:hover {
      color: #ffd54f;
    }
    @media (max-width: 600px) {
      .container { margin-top: 18px; padding: 16px 4vw 16px 4vw; }
      h1 { font-size: 1.32em;}
      .feature { font-size: 0.94em;}
      .button { font-size: 1em; }
    }
  </style>
</head>
<body>
  <div class="container" id="mainContainer">
    <!-- –∫–æ–Ω—Ç–µ–Ω—Ç –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
  </div>
  <!-- VKID SDK —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å tg_id -->
  <script>
    // ===== –§–†–û–ù–¢: –º–∞–≥–∏—á–µ—Å–∫–∏–π –ª–µ–Ω–¥–∏–Ω–≥ + VK ID Auth =====

    // –í—Å–ø–æ–º–æ–≥–∞–ª–∫–∏
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }
    const tg_id = getQueryParam('tg_id');
    const main = document.getElementById('mainContainer');

    if (!tg_id) {
      // --- –ú–ê–ì–ò–ß–ï–°–ö–ò–ô –õ–ï–ù–î–ò–ù–ì ---
      main.innerHTML = `
        <h1>–ú–∞–≥–∏—á–µ—Å–∫–∏–π –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫ ‚Äú–§–æ–∫—É—Å–Ω–∏–∫ –ê–ª—å—Ç–∞–∏—Ä‚Äù üßôüèº‚Äç‚ôÇÔ∏è</h1>
        <div class="motivation">–ü–æ–º–æ–≥–∞–µ—Ç —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –≤–∞–∂–Ω–æ–º –∏ –Ω–µ –∑–∞–ª–∏–ø–Ω—É—Ç—å –≤ –ª–µ–Ω—Ç–µ</div>
        <div class="desc">
          –≠—Ç–æ—Ç –±–æ—Ç —É–º–µ–µ—Ç –≤ –æ–¥–Ω–æ –∫–∞—Å–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ –≤–∞—à–∏—Ö –ª—é–±–∏–º—ã—Ö VK-–≥—Ä—É–ø–ø –ø—Ä—è–º–æ –≤ Telegram.<br>
          –ë–µ–∑ –ª–∏—à–Ω–∏—Ö —Ö–ª–æ–ø–æ—Ç ‚Äî —Ç–æ–ª—å–∫–æ —Å–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —Å –º–∞–≥–∏—á–µ—Å–∫–∏–º —É–¥–æ–±—Å—Ç–≤–æ–º –∏ –∑–∞–±–æ—Ç–æ–π –æ –≤–∞—à–µ–π –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ ‚ú®
        </div>
        <div class="magic">–ü—É—Å—Ç—å —Ü–∏—Ñ—Ä–æ–≤–∞—è –ª–µ–Ω—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–µ–±—è, –∞ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç!<br>
        –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏ –≤–æ–ª—à–µ–±—Å—Ç–≤–æ ‚Äî –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º ü™Ñ</div>
        <div class="features">
          <div class="feature">‚ú® –í—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∞—è –ª–µ–Ω—Ç–∞ VK</div>
          <div class="feature">üîí –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram</div>
          <div class="feature">üßô –ü—Ä–æ—Å—Ç–æ, –±—ã—Å—Ç—Ä–æ, –º–∞–≥–∏—á–µ—Å–∫–∏!</div>
        </div>
        <a class="button" href="https://t.me/fokusnik_altair_bot" target="_blank" rel="noopener">
          –ü–µ—Ä–µ–π—Ç–∏ –≤ Telegram –∏ –Ω–∞—á–∞—Ç—å –º–∞–≥–∏—é üîÆ
        </a>
        <div class="privacy">
          –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é VK ID.<br>
          –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥ –æ—Ö—Ä–∞–Ω–æ–π –º–∞–≥–∏—á–µ—Å–∫–æ–π –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ üõ°Ô∏è<br>
          <a href="https://api.fokusnikaltair.xyz/privacy.html" target="_blank">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
        </div>
        <div class="contact">
          –°–≤—è–∑–∞—Ç—å—Å—è —Å –º–∞–≥–∏—Å—Ç—Ä–æ–º –±–æ—Ç–∞: <a href="mailto:altair93055@gmail.com">altair93055@gmail.com</a>
        </div>
      `;
    } else {
      // --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –ß–ï–†–ï–ó VK ID (OneTap) ---
      main.innerHTML = `
        <h1>–§–æ–∫—É—Å–Ω–∏–∫ –ê–ª—å—Ç–∞–∏—Ä ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ VK ID</h1>
        <div class="desc">
          –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å—É –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ VK ID:<br>
          <span style="color:#b2dfdb">–í–∞—à Telegram ID ‚Äî <b>${tg_id}</b></span>
        </div>
        <div class="vk-container">
          <div id="VkIdSdkOneTap"></div>
          <div id="error" class="error"></div>
          <div id="success" class="success"></div>
        </div>
        <div class="privacy">
          –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã. <a href="https://api.fokusnikaltair.xyz/privacy.html" target="_blank">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
        </div>
      `;

      // –í—Å—ë –¥–ª—è PKCE
      function generateCodeVerifier() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-';
        let arr = Array.from(crypto.getRandomValues(new Uint8Array(64)));
        return arr.map(x => chars[x % chars.length]).join('');
      }
      async function generateCodeChallenge(verifier) {
        const encoder = new TextEncoder();
        const data = encoder.encode(verifier);
        const hash = await window.crypto.subtle.digest('SHA-256', data);
        let base64 = btoa(String.fromCharCode(...new Uint8Array(hash)))
          .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
        return base64;
      }

      (async () => {
        const code_verifier = generateCodeVerifier();
        const code_challenge = await generateCodeChallenge(code_verifier);

        if (!('VKIDSDK' in window)) {
          document.getElementById('error').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ VKID SDK!';
          return;
        }
        const VKID = window.VKIDSDK;

        VKID.Config.init({
          app: 53336238,
          redirectUrl: 'https://api.fokusnikaltair.xyz/auth/vk/callback',
          state: tg_id,
          scope: 'groups',
          pkce: {
            codeChallenge: code_challenge,
            codeChallengeMethod: 'S256'
          }
        });

        const oneTap = new VKID.OneTap();
        oneTap
          .on(window.VKIDSDK.OneTapInternalEvents.LOGIN_SUCCESS, async ({ code, device_id, state }) => {
            try {
              const res = await fetch('/auth/vk/token', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  code,
                  code_verifier,
                  device_id,
                  tg_id: state
                })
              });
              const result = await res.json();
              if (result.success) {
                document.getElementById('success').textContent = '–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è! –ú–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ Telegram.';
              } else {
                document.getElementById('error').textContent = result.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è.';
              }
            } catch (err) {
              document.getElementById('error').textContent = '–û—à–∏–±–∫–∞ –æ–±–º–µ–Ω–∞ –∫–æ–¥–∞ –Ω–∞ —Ç–æ–∫–µ–Ω: ' + err.message;
            }
          })
          .on(window.VKIDSDK.WidgetEvents.ERROR, (err) => {
            document.getElementById('error').textContent = '–û—à–∏–±–∫–∞ VK ID: ' + (err.message || err);
          });

        oneTap.render({ container: document.getElementById('VkIdSdkOneTap') });
      })();
    }
  </script>
</body>
</html>
