<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Портал активации открыт!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap" rel="stylesheet">
  <style>
    html, body {
      width: 100vw;
      min-width: 100vw;
      max-width: 100vw;
      min-height: 100vh;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      overflow-x: hidden;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    body {
      background: linear-gradient(135deg, #764ba2 0%, #667eea 55%, #1de9b6 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      position: relative;
    }
    .stars-bg { position: fixed; z-index: 0; width: 100vw; height: 100vh; left: 0; top: 0; pointer-events: none; }
    .star { position: absolute; opacity: 0.13; filter: blur(0.2px);}
    .star1 { width:34px; top:11%; left:7%; opacity:.15;}
    .star2 { width:21px; top:18%; left:21%; opacity:.10;}
    .star3 { width:29px; top:28%; left:81%; opacity:.13;}
    .star4 { width:17px; top:65%; left:17%; opacity:.10;}
    .star5 { width:28px; top:53%; left:68%; opacity:.14;}
    .star6 { width:26px; top:77%; left:85%; opacity:.13;}
    .star7 { width:20px; top:89%; left:13%; opacity:.09;}
    .star8 { width:36px; top:15%; left:78%; opacity:.15;}
    .star9 { width:23px; top:75%; left:44%; opacity:.11;}
    .star10 { width:30px; top:67%; left:94%; opacity:.11;}
    .star11 { width:19px; top:31%; left:41%; opacity:.14;}
    .star12 { width:24px; top:13%; left:59%; opacity:.12;}
    .star13 { width:28px; top:83%; left:59%; opacity:.10;}
    .star14 { width:22px; top:39%; left:85%; opacity:.09;}
    .star15 { width:20px; top:50%; left:28%; opacity:.13;}
    .star16 { width:18px; top:20%; left:62%; opacity:.12;}
    .star17 { width:34px; top:84%; left:74%; opacity:.11;}
    .star18 { width:24px; top:23%; left:51%; opacity:.12;}
    .star19 { width:22px; top:92%; left:77%; opacity:.10;}
    .star20 { width:31px; top:59%; left:80%; opacity:.13;}

    .page-content {
      position: relative;
      z-index: 2;
      width: 100%;
      max-width: 600px;
      margin: 64px 0 0 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 80vh;
    }
    .big-title {
      color: #fff;
      font-size: 2.5em;
      font-weight: 700;
      margin-bottom: 30px;
      margin-top: 18px;
      line-height: 1.15;
      text-align: left;
      align-self: flex-start;
      margin-left: 30px;
      text-shadow: 0 2px 24px #522a8f33;
      max-width: 100%;
    }
    .subtitle {
      color: #fff;
      font-size: 1.08em;
      margin-right: 35px;
      margin-bottom: 29px;
      font-weight: 400;
      text-align: left;
      text-shadow: 0 1px 16px #331b5099;
    }
    .subtitle.subtitle-small {
      font-size: 1em; 
      margin-right: 60px;
      font-weight: 400;
      margin-bottom: 22px; 
      text-align: left;
    }
    .vk-btn {
      background: #fff;
      color: #0077FF;
      border: 2px solid #0077FF;
      display: inline-flex;
      align-items: center;
      border-radius: 24px;
      height: 52px;
      min-width: 240px;
      padding: 0 28px;
      font-size: 1.16em;
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 500;
      cursor: pointer;
      margin-top: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 12px #0077FF19;
      text-decoration: none;
      user-select: none;
      letter-spacing: 0.01em;
      transition: background 0.14s, color 0.13s, border 0.12s;
    }
    .vk-btn:hover {
      background: #f6fbff;
      color: #0054b0;
      border-color: #0054b0;
    }
    .vk-btn img {
      margin-right: 11px;
      width: 32px;
      height: 32px;
      min-width: 32px;
      border-radius: 50%;
      background: #0077FF;
      display: inline-block;
    }
    .safe-info {
      color: #fff;
      margin: 0 auto 16px auto;
      text-align: center;
      font-size: 1.07em;
      opacity: 0.9;
      text-shadow: 0 1px 12px #331b507a;
    }
    .wizard-box {
      width: 100%;
      display: flex;
      justify-content: flex-end;
      align-items: flex-end;
      min-height: 150px;
      margin: 10px auto 16px auto;
      position: relative;
    }
    .wizard-img-wrap {
      display: inline-block;
      /* Мягкое белое и коричневатое свечение вокруг PNG */
      filter: drop-shadow(0 0 48px #fff) drop-shadow(0 14px 48px #a68e79cc);
    }
    .wizard-img {
      width: 185px;
      max-width: 54vw;
      margin: 0;
      display: block;
      user-select: none;
    }
    .footer-links {
      color: #fff;
      text-align: center;
      font-size: 1em;
      margin: 12px auto 0 auto;
      opacity: 0.96;
      text-shadow: 0 2px 10px #502b9562;
    }
    .footer-links a {
      color: #d6f7ff;
      text-decoration: underline;
      margin-left: 6px;
      margin-right: 6px;
    }
    @media (max-width: 600px) {
      .big-title {
        font-size: 1.7em;
        margin-left: 35px;
      }
     .subtitle {
      color: #fff;
      font-size: 1.08em;
      margin-right: 35px;
      margin-bottom: 29px;
      font-weight: 400;
      text-align: left;
      text-shadow: 0 1px 16px #331b5099;
    }
    .subtitle.subtitle-small {
      font-size: 1em;           /* чуть меньше */
      font-weight: 400;
      margin-bottom: 22px;      /* чуть больше отступ после этой строки */
    }
      .wizard-box {
        justify-content: flex-end;
        margin-top: 7vw;
        min-height: 50vw;
        overflow: visible;
      }
      .wizard-img-wrap {
        filter: drop-shadow(0 0 48px #fff) drop-shadow(0 14px 48px #a68e79cc);
      }
      .wizard-img {
        width: 49vw;
        max-width: 60vw;
        display: block;
      }
      .footer-links { font-size: 0.95em; }
    }
  </style>
</head>
<body>
  <!-- ======= ФОН ЗВЕЗДЫ ======= -->
  <div class="stars-bg">
    <img class="star star1" src="/star 1.png" alt="" />
    <img class="star star2" src="/star 1.png" alt="" />
    <img class="star star3" src="/star 1.png" alt="" />
    <img class="star star4" src="/star 1.png" alt="" />
    <img class="star star5" src="/star 1.png" alt="" />
    <img class="star star6" src="/star 1.png" alt="" />
    <img class="star star7" src="/star 1.png" alt="" />
    <img class="star star8" src="/star 1.png" alt="" />
    <img class="star star9" src="/star 1.png" alt="" />
    <img class="star star10" src="/star 1.png" alt="" />
    <img class="star star11" src="/star 1.png" alt="" />
    <img class="star star12" src="/star 1.png" alt="" />
    <img class="star star13" src="/star 1.png" alt="" />
    <img class="star star14" src="/star 1.png" alt="" />
    <img class="star star15" src="/star 1.png" alt="" />
    <img class="star star16" src="/star 1.png" alt="" />
    <img class="star star17" src="/star 1.png" alt="" />
    <img class="star star18" src="/star 1.png" alt="" />
    <img class="star star19" src="/star 1.png" alt="" />
    <img class="star star20" src="/star 1.png" alt="" />
  </div>
  <!-- ======= /ФОН ЗВЕЗДЫ ======= -->

  <div class="page-content">
    <div class="big-title">Портал активации открыт!</div>
    <div class="subtitle">
      Войди через VK, чтобы волшебство продолжалось в Telegram.
    </div>
    <div class="subtitle subtitle-small">
  Просто авторизуйся — и нужные группы появятся у тебя в боте.
</div>
    <button class="vk-btn" id="vk-auth-btn">
      <img src="/VK Logo.png" alt="VK" width="32" height="32">
      Войти через VK ID
    </button>
    <div class="safe-info">
      Бот не получает доступ к вашему паролю.<br>
      Ваши данные в безопасности
    </div>
    <div class="wizard-box">
      <div class="wizard-img-wrap">
        <img class="wizard-img" src="/wizard 2.png" alt="Волшебник Альтаир">
      </div>
    </div>
    <div class="footer-links">
      <a href="https://api.fokusnikaltair.xyz/privacy.html" target="_blank">Политика конфиденциальности</a><br>
      Связь с магистром: <a href="mailto:altair93055@gmail.com">altair93055@gmail.com</a>
    </div>
  </div>

  <script>
    // Авторизация (как у тебя)
    function getTgId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('tg_id');
    }
    function generateCodeVerifier(length = 128) {
      const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~';
      let result = '';
      const array = new Uint32Array(length);
      window.crypto.getRandomValues(array);
      for (let i = 0; i < length; i++) {
        result += charset[array[i] % charset.length];
      }
      return result;
    }
    function base64UrlEncode(buffer) {
      return btoa(String.fromCharCode(...new Uint8Array(buffer)))
        .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
    }
    async function generateCodeChallenge(codeVerifier) {
      const encoder = new TextEncoder();
      const data = encoder.encode(codeVerifier);
      const hash = await window.crypto.subtle.digest('SHA-256', data);
      return base64UrlEncode(hash);
    }
    async function startAuth() {
      const tg_id = getTgId();
      if (!tg_id) {
        alert('Ошибка: не передан Telegram ID (tg_id)');
        return;
      }
      const client_id = '53336238';
      const redirect_uri = encodeURIComponent('https://api.fokusnikaltair.xyz/vk-callback.html');
      const scope = 'groups';
      const response_type = 'code';
      const state = encodeURIComponent(tg_id);
      const codeVerifier = generateCodeVerifier();
      sessionStorage.setItem('code_verifier', codeVerifier);
      const codeChallenge = await generateCodeChallenge(codeVerifier);

      const url = `https://id.vk.com/authorize?client_id=${client_id}&redirect_uri=${redirect_uri}&scope=${scope}&response_type=${response_type}&state=${state}&code_challenge=${codeChallenge}&code_challenge_method=S256&v=5.131`;
      window.location.href = url;
    }
    document.getElementById('vk-auth-btn').addEventListener('click', startAuth);
  </script>
</body>
</html>
