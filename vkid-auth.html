<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Портал активации открыт!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap" rel="stylesheet">
  <style>
    body {
      min-height: 100vh;
      margin: 0;
      font-family: 'Montserrat', Arial, sans-serif;
      /* БОЛЬШЕ ЗЕЛЁНОГО */
      background: linear-gradient(135deg, #764ba2 0%, #667eea 55%, #1de9b6 100%);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      position: relative;
      overflow-x: hidden;
    }
    /* === Звезды === */
    .stars-bg {
      position: fixed;
      z-index: 0;
      width: 100vw;
      height: 100vh;
      left: 0; top: 0;
      pointer-events: none;
      overflow: hidden;
    }
    .star {
      position: absolute;
      opacity: 0.13;
      filter: blur(0.2px);
    }
    /* 20 звезд с разными стилями */
    .star1 { width:34px; top:11%; left:7%; opacity:.15;}
    .star2 { width:21px; top:18%; left:21%; opacity:.10;}
    .star3 { width:29px; top:28%; left:81%; opacity:.13;}
    .star4 { width:17px; top:65%; left:17%; opacity:.10;}
    .star5 { width:28px; top:53%; left:68%; opacity:.14;}
    .star6 { width:26px; top:77%; left:85%; opacity:.13;}
    .star7 { width:20px; top:89%; left:13%; opacity:.09;}
    .star8 { width:36px; top:15%; left:78%; opacity:.15;}
    .star9 { width:23px; top:75%; left:44%; opacity:.11;}
    .star10 { width:30px; top:67%; left:94%; opacity:.11;}
    .star11 { width:19px; top:31%; left:41%; opacity:.14;}
    .star12 { width:24px; top:13%; left:59%; opacity:.12;}
    .star13 { width:28px; top:83%; left:59%; opacity:.10;}
    .star14 { width:22px; top:39%; left:85%; opacity:.09;}
    .star15 { width:20px; top:50%; left:28%; opacity:.13;}
    .star16 { width:18px; top:20%; left:62%; opacity:.12;}
    .star17 { width:34px; top:84%; left:74%; opacity:.11;}
    .star18 { width:24px; top:23%; left:51%; opacity:.12;}
    .star19 { width:22px; top:92%; left:77%; opacity:.10;}
    .star20 { width:31px; top:59%; left:80%; opacity:.13;}
    /* === /звезды === */

    .main-content {
      position: relative;
      z-index: 2;
      width: 100%;
      max-width: 420px;
      background: rgba(255,255,255,0.94);
      border-radius: 28px;
      margin: 62px 0 36px 0;
      padding: 36px 34px 36px 34px;
      box-shadow: 0 8px 32px 0 #331b509c;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 450px;
    }
    .big-title {
      color: #522a8f;
      font-size: 2.1em;
      font-weight: 700;
      margin-bottom: 16px;
      line-height: 1.15;
      text-align: center;
    }
    .subtitle {
      color: #573d87;
      font-size: 1.19em;
      margin-bottom: 26px;
      font-weight: 400;
      text-align: center;
    }
    .vk-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #0077FF;
      color: #fff;
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 500;
      font-size: 1.1em;
      border: none;
      border-radius: 22px;
      height: 54px;
      min-width: 240px;
      padding: 0 26px;
      cursor: pointer;
      margin-top: 15px;
      margin-bottom: 22px;
      box-shadow: 0 2px 20px #2c6ae388;
      transition: background 0.14s, box-shadow 0.18s;
      font-size: 1.23em;
      text-decoration: none;
      user-select: none;
      letter-spacing: 0.01em;
    }
    .vk-btn:hover { background: #0857ad; }
    .vk-btn svg, .vk-btn img {
      margin-right: 11px;
      width: 32px; height: 32px; min-width: 32px;
      background: #fff; border-radius: 50%;
      display: inline-block;
    }
    .safe-info {
      color: #522a8f;
      margin: 0 auto 18px auto;
      text-align: center;
      font-size: 1.01em;
      opacity: 0.85;
    }
    .wizard-box {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      min-height: 160px;
      margin-bottom: 16px;
      position: relative;
    }
    .wizard-img {
      width: 170px;
      max-width: 55vw;
      margin: 0 auto 0 0;
      display: block;
      user-select: none;
    }
    .footer-links {
      color: #6e659d;
      text-align: center;
      font-size: 1em;
      margin: 12px auto 0 auto;
      opacity: 0.92;
    }
    .footer-links a {
      color: #3a75e6;
      text-decoration: underline;
      margin-left: 6px;
      margin-right: 6px;
    }
    /* Мобильная версия */
    @media (max-width: 600px) {
      .main-content {
        max-width: 99vw;
        padding: 17vw 4vw 8vw 4vw;
        margin: 20px 0 14vw 0;
        min-height: unset;
      }
      .big-title { font-size: 1.21em; }
      .subtitle { font-size: 0.99em; }
      .wizard-img { width: 45vw; }
      .footer-links { font-size: 0.95em; }
    }
  </style>
</head>
<body>
  <!-- ======= ФОН ЗВЕЗДЫ ======= -->
  <div class="stars-bg">
    <img class="star star1" src="/star 1.png" alt="" />
    <img class="star star2" src="/star 1.png" alt="" />
    <img class="star star3" src="/star 1.png" alt="" />
    <img class="star star4" src="/star 1.png" alt="" />
    <img class="star star5" src="/star 1.png" alt="" />
    <img class="star star6" src="/star 1.png" alt="" />
    <img class="star star7" src="/star 1.png" alt="" />
    <img class="star star8" src="/star 1.png" alt="" />
    <img class="star star9" src="/star 1.png" alt="" />
    <img class="star star10" src="/star 1.png" alt="" />
    <img class="star star11" src="/star 1.png" alt="" />
    <img class="star star12" src="/star 1.png" alt="" />
    <img class="star star13" src="/star 1.png" alt="" />
    <img class="star star14" src="/star 1.png" alt="" />
    <img class="star star15" src="/star 1.png" alt="" />
    <img class="star star16" src="/star 1.png" alt="" />
    <img class="star star17" src="/star 1.png" alt="" />
    <img class="star star18" src="/star 1.png" alt="" />
    <img class="star star19" src="/star 1.png" alt="" />
    <img class="star star20" src="/star 1.png" alt="" />
  </div>
  <!-- ======= /ФОН ЗВЕЗДЫ ======= -->

  <div class="main-content">
    <div class="big-title">Портал активации открыт!</div>
    <div class="subtitle">
      Войди через VK, чтобы волшебство продолжалось в Telegram.
    </div>
    <button class="vk-btn" id="vk-auth-btn">
      <!-- SVG логотип VK (замени при желании на <img src="/vk_logo.png" ...>) -->
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 28 28">
        <rect width="28" height="28" rx="14" fill="#fff"/>
        <path d="M14 0C6.27 0 0 6.27 0 14s6.27 14 14 14 14-6.27 14-14S21.73 0 14 0zm5.32 10.24c.12-.41 0-.67-.58-.67h-1.93c-.48 0-.7.24-.81.52 0 0-1 2.41-2.4 3.97-.46.46-.67.6-.93.6-.13 0-.31-.13-.31-.52v-3.81c0-.45-.13-.67-.52-.67h-2.98c-.29 0-.48.21-.48.43 0 .41.61.5.67 1.67v2.49c0 .55-.1.65-.3.65-.59 0-2.02-2.4-2.87-5.13-.15-.44-.32-.57-.74-.57H4.56c-.41 0-.41.19-.41.46 0 .46.7 2.88 3.37 6.06 1.41 1.69 2.89 1.63 2.89 1.63h1.18c.41 0 .56-.19.61-.42 0 0 .16-.39.23-.53.07-.15.21-.18.31-.18.09 0 .22.03.33.13.1.09.13.21.13.33v1.09c0 .32.08.45.47.45h1.99c.27 0 .45-.12.49-.39.04-.24-.07-.38-.28-.46-.39-.13-1.18-.42-1.68-1.11-.14-.18-.22-.38-.18-.6.06-.32.29-.53.62-.53h1.68c.47 0 .83-.11 1.13-.32.3-.21.54-.55.73-1 .19-.45.29-.94.29-1.48v-1.06c0-.46-.17-.68-.5-.68-.28 0-.46.19-.54.41z" fill="#0077FF"/>
      </svg>
      Войти через VK ID
    </button>
    <div class="safe-info">
      Бот не получает доступ к вашему паролю.<br>
      Ваши данные в безопасности
    </div>
    <div class="wizard-box">
      <img class="wizard-img" src="/wizard 2.png" alt="Волшебник Альтаир">
    </div>
    <div class="footer-links">
      <a href="https://api.fokusnikaltair.xyz/privacy.html" target="_blank">Политика конфиденциальности</a><br>
      Связь с магистром: <a href="mailto:altair93055@gmail.com">altair93055@gmail.com</a>
    </div>
  </div>

  <script>
    // Всё как было!
    function getTgId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('tg_id');
    }
    function generateCodeVerifier(length = 128) {
      const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~';
      let result = '';
      const array = new Uint32Array(length);
      window.crypto.getRandomValues(array);
      for (let i = 0; i < length; i++) {
        result += charset[array[i] % charset.length];
      }
      return result;
    }
    function base64UrlEncode(buffer) {
      return btoa(String.fromCharCode(...new Uint8Array(buffer)))
        .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
    }
    async function generateCodeChallenge(codeVerifier) {
      const encoder = new TextEncoder();
      const data = encoder.encode(codeVerifier);
      const hash = await window.crypto.subtle.digest('SHA-256', data);
      return base64UrlEncode(hash);
    }
    async function startAuth() {
      const tg_id = getTgId();
      if (!tg_id) {
        alert('Ошибка: не передан Telegram ID (tg_id)');
        return;
      }
      const client_id = '53336238'; // твой VK APP ID
      const redirect_uri = encodeURIComponent('https://api.fokusnikaltair.xyz/vk-callback.html');
      const scope = 'groups';
      const response_type = 'code';
      const state = encodeURIComponent(tg_id);
      const codeVerifier = generateCodeVerifier();
      sessionStorage.setItem('code_verifier', codeVerifier);
      const codeChallenge = await generateCodeChallenge(codeVerifier);

      const url = `https://id.vk.com/authorize?client_id=${client_id}&redirect_uri=${redirect_uri}&scope=${scope}&response_type=${response_type}&state=${state}&code_challenge=${codeChallenge}&code_challenge_method=S256&v=5.131`;
      window.location.href = url;
    }
    document.getElementById('vk-auth-btn').addEventListener('click', startAuth);
  </script>
</body>
</html>
